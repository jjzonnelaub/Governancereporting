function getInitiativeReportDialogHTML() {
  return `
    <!DOCTYPE html>
    <html>
      <head>
        <style>
          * { box-sizing: border-box; margin: 0; padding: 0; }
          body { font-family: 'Google Sans', 'Roboto', Arial, sans-serif; padding: 20px; background: #fff; }
          .container { max-width: 450px; margin: 0 auto; }
          h2 { color: #1a73e8; margin-bottom: 8px; font-size: 20px; font-weight: 500; }
          .subtitle { color: #5f6368; font-size: 14px; margin-bottom: 24px; }
          .section { background: #f8f9fa; border-radius: 8px; padding: 16px; margin-bottom: 20px; }
          .section-title { color: #3c4043; font-weight: 500; margin-bottom: 12px; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
          .input-group { margin-bottom: 16px; }
          .input-group:last-child { margin-bottom: 0; }
          .pi-input, .select-input { width: 100%; padding: 12px; font-size: 16px; border: 2px solid #dadce0; border-radius: 8px; transition: border-color 0.2s; background: white; }
          .pi-input:focus, .select-input:focus { outline: none; border-color: #1a73e8; }
          .select-input:disabled { background: #f1f3f4; cursor: not-allowed; }
          .checkbox-container { display: flex; align-items: center; gap: 10px; padding: 12px; background: white; border: 2px solid #dadce0; border-radius: 8px; cursor: pointer; transition: border-color 0.2s; }
          .checkbox-container:hover { border-color: #1a73e8; }
          .checkbox-container input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
          .checkbox-label { flex: 1; font-size: 14px; color: #3c4043; cursor: pointer; user-select: none; }
          .button-container { display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; }
          button { padding: 10px 24px; font-size: 14px; border-radius: 6px; border: none; cursor: pointer; font-weight: 500; transition: all 0.2s; font-family: inherit; }
          .primary-button { background: #1a73e8; color: white; }
          .primary-button:hover:not(:disabled) { background: #1557b0; }
          .primary-button:disabled { background: #94c1f5; cursor: not-allowed; }
          .secondary-button { background: #ffffff; color: #5f6368; border: 1px solid #dadce0; }
          .secondary-button:hover { background: #f8f9fa; }
          .error { color: #d93025; font-size: 12px; margin-top: 8px; display: none; }
          .error.show { display: block; }
          .info-box { background: #e8f0fe; border-left: 4px solid #1a73e8; padding: 12px; border-radius: 4px; margin-bottom: 20px; font-size: 13px; color: #174ea6; }
          .loading { display: none; text-align: center; padding: 20px; }
          .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #1a73e8; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
          #status-text { margin-top: 16px; color: #5f6368; font-size: 14px; }
          @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        </style>
      </head>
      <body>
        <div class="container">
          <h2>Generate Initiative Report</h2>
          <div class="subtitle">Create a PI report filtered by Program or Portfolio Initiative.</div>
          
          <div id="form-container">
            <div class="section">
              <div class="section-title">Program Increment</div>
              <div class="input-group">
                <input type="text" id="piNumber" class="pi-input" placeholder="Enter PI number (e.g., 12)" autocomplete="off" onkeypress="return event.charCode >= 48 && event.charCode <= 57" onchange="loadInitiatives()" />
                <div id="piError" class="error">Please enter a valid PI number</div>
              </div>
            </div>

            <div class="section">
              <div class="section-title">Initiative Type</div>
              <div class="input-group">
                <select id="initiativeFieldSelect" class="select-input" onchange="loadInitiatives()">
                  <option value="">-- Select Initiative Type --</option>
                  <option value="Program Initiative">Program Initiative</option>
                  <option value="Portfolio Initiative">Portfolio Initiative</option>
                </select>
                <div id="fieldError" class="error">Please select an initiative type</div>
              </div>
            </div>

            <div class="section">
              <div class="section-title">Initiative</div>
              <div class="input-group">
                <select id="initiativeValueSelect" class="select-input" disabled>
                  <option value="">Select PI and Initiative Type first</option>
                </select>
                <div id="valueError" class="error">Please select an initiative</div>
              </div>
            </div>

            <div class="section">
              <div class="section-title">Program Increment Filter</div>
              <div class="input-group">
                <label class="checkbox-container" onclick="toggleCheckbox('includePrePlanning')">
                  <input type="checkbox" id="includePrePlanning" checked />
                  <span class="checkbox-label">Include "Pre-Planning" Program Increment</span>
                </label>
              </div>
              <small style="color: #5f6368; font-size: 12px;">
                When checked, epics with Program Increment = "Pre-Planning" will be included. Uncheck to exclude them.
              </small>
            </div>

            <div class="section">
              <div class="section-title">Filter by PI Commitment (Optional)</div>
              <div class="input-group">
                <select id="piCommitmentFilter" class="select-input">
                  <option value="All" selected>All (no filter)</option>
                  <option value="Blank">Blank</option>
                  <option value="Committed">Committed</option>
                  <option value="Committed After Plan">Committed After Plan</option>
                </select>
              </div>
              <small style="color: #5f6368; font-size: 12px;">
                Filter epics based on their PI Commitment status. Default is "All".
              </small>
            </div>

            <div class="info-box">
              <strong>ðŸ“Š Initiative Report:</strong> Will generate a presentation for all epics under the selected Program or Portfolio Initiative, regardless of Value Stream.
            </div>

            <div class="button-container">
              <button class="secondary-button" onclick="google.script.host.close()">Cancel</button>
              <button id="generateBtn" class="primary-button" onclick="generateReport()">Generate</button>
            </div>
          </div>

          <div id="loading" class="loading">
            <div class="spinner"></div>
            <p id="status-text">Generating presentation...</p>
          </div>
        </div>

        <script>
          let availableInitiatives = [];

          function toggleCheckbox(checkboxId) {
            const checkbox = document.getElementById(checkboxId);
            checkbox.checked = !checkbox.checked;
          }

          function loadInitiatives() {
            const piNumber = document.getElementById('piNumber').value.trim();
            const initiativeField = document.getElementById('initiativeFieldSelect').value;
            const valueSelect = document.getElementById('initiativeValueSelect');
            
            // Reset value select
            valueSelect.innerHTML = '<option value="">Loading...</option>';
            valueSelect.disabled = true;
            
            if (!piNumber || !initiativeField) {
              valueSelect.innerHTML = '<option value="">Select PI and Initiative Type first</option>';
              return;
            }

            // Clear any previous errors
            document.querySelectorAll('.error').forEach(el => el.classList.remove('show'));

            google.script.run
              .withSuccessHandler(function(initiatives) {
                availableInitiatives = initiatives || [];
                
                if (availableInitiatives.length === 0) {
                  valueSelect.innerHTML = '<option value="">No initiatives found for PI ' + piNumber + '</option>';
                  valueSelect.disabled = true;
                } else {
                  valueSelect.innerHTML = '<option value="">-- Select Initiative --</option>';
                  availableInitiatives.forEach(initiative => {
                    const option = document.createElement('option');
                    option.value = initiative;
                    option.textContent = initiative;
                    valueSelect.appendChild(option);
                  });
                  valueSelect.disabled = false;
                }
              })
              .withFailureHandler(function(error) {
                console.error('Error loading initiatives:', error);
                alert('Error loading initiatives: ' + error);
                valueSelect.innerHTML = '<option value="">Error loading initiatives</option>';
                valueSelect.disabled = true;
              })
              .getAvailableInitiatives(parseInt(piNumber), initiativeField);
          }

          function generateReport() {
            // Clear previous errors
            document.querySelectorAll('.error').forEach(el => el.classList.remove('show'));
            
            const piNumber = document.getElementById('piNumber').value.trim();
            const initiativeField = document.getElementById('initiativeFieldSelect').value;
            const initiativeValue = document.getElementById('initiativeValueSelect').value;
            const piCommitmentFilter = document.getElementById('piCommitmentFilter').value;
            const includePrePlanning = document.getElementById('includePrePlanning').checked;
            
            // Validation
            let hasError = false;
            
            if (!piNumber || isNaN(piNumber)) {
              document.getElementById('piError').classList.add('show');
              hasError = true;
            }
            
            if (!initiativeField) {
              document.getElementById('fieldError').classList.add('show');
              hasError = true;
            }
            
            if (!initiativeValue) {
              document.getElementById('valueError').classList.add('show');
              hasError = true;
            }
            
            if (hasError) return;
            
            // Show loading state
            document.getElementById('form-container').style.display = 'none';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('status-text').textContent = 'Generating presentation...';
            
            // Call the backend function
            google.script.run
              .withSuccessHandler(function(result) {
                document.getElementById('status-text').textContent = 'Complete! âœ…';
                if (result && result.url) {
                  setTimeout(() => {
                    window.open(result.url, '_blank');
                    google.script.host.close();
                  }, 1000);
                } else {
                  setTimeout(() => google.script.host.close(), 1500);
                }
              })
              .withFailureHandler(function(error) {
                document.getElementById('status-text').textContent = 'Error occurred âŒ';
                alert('Error generating presentation: ' + error);
                setTimeout(() => google.script.host.close(), 2000);
              })
              .generateInitiativePresentation(
                parseInt(piNumber),
                initiativeField,
                initiativeValue,
                'FINAL',
                null,
                piCommitmentFilter,
                includePrePlanning
              );
          }
        </script>
      </body>
    </html>
  `;
}